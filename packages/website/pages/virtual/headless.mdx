import CommonHead from "/components/CommonHead";
import Link from "next/link";

## Installation

```bash
# npm
npm i -S @af-utils/react-virtual-headless prop-types use-sync-external-store

# yarn
yarn add @af-utils/react-virtual-headless prop-types use-sync-external-store
```

---

## useVirtual

Core hook. Used to get scroller model instance synchronized with props.

```jsx
const model = useVirtual({
    itemCount,
    getEstimatedItemSize,
    overscanCount,
    estimatedWidgetSize,
    horizontal
});
```

#### `itemCount: Integer`

Quantity of items. Defaults to `0`.

#### `getEstimatedItemSize: Function( itemSizes, scrollSize, newItemCount ) => Integer`

Best-guess item size. Defaults to `scrollSize / itemSizes.length` or `40` if no items.

#### `overscanCount: Integer`

Minimum amount of items to load behind/ahead(depends on scroll direction) of the current visible range. Defaults to `3`.

#### `horizontal: Boolean`

Determines, whether scrollTop/offsetHeight or scrollLeft/offsetWidth are used in calculations. Defaults to `false`.

#### `estimatedWidgetSize: Integer`

Widget size to use before ResizeObserver measurements are ready.
Used mainly for server-side rendering. If you want to disable SSR - put `0` here.
Defaults to `200`.

### Returns

Scroller model instance with following public props:

#### `itemCount: Integer`

The total count of elements. Same as passed to [`useVirtual()`](#usevirtual).

#### `from: Integer`

Visible range start.

#### `to: Integer`

Visible range end.

#### `scrollSize: Integer`

Sum of all item sizes.

#### `getIndex: Function(offset: Integer) => Integer`

Get element index pixel offset.

#### `getOffset: Function(index: Integer) => Integer`

Get pixel offset for element index.

#### `scrollTo: Function(index: Integer, pixelOffset: Integer ) => void 0`

Scroll to element at certain index and add pixel offset.

#### `setOuterNode: Bound Function(el: DOMElement) => void 0`

Pass scrollable element to model. Must be attached to outermost element with `overflow: auto`.

---

## mapVisibleRange

```jsx
mapVisibleRange(model, callback, provideOffset);
```

#### `model: Model`

**Required**. Return value of [`useVirtual()`](#usevirtual).

#### `callback: Function( index, offset ) => ReactElement`

**Required**. Function called for each visible element index.

#### `countOffset: Boolean`

Should provide offset to callback or not. Defaults to: `false`.

### Returns

`Array<ReactElement>`

---

## Numeric event constants

Scroller model has build-in event emitter. All possible events are exported.

-   `EVT_FROM`

    Start of visible range changed.

-   `EVT_TO`

    End of visible range changed. Used to make [load on demand](/virtual/examples/list/LoadOnDemand).

-   `EVT_SCROLL_SIZE`

    Sum of item sizes changed.

-   `EVT_SIZES`

    At least one item size changed. Used, when all items are `position: absolute` and are not automatically realigned
    when siblinbgs are resized.

-   `EVT_ALL`_(array of events above)_

---

## useSubscription

Called, when at least one of passed [events](#numeric-event-constants) is triggered.

```jsx
useSubscription(model, () => {}, events);
```

#### `model: Model`

**Required**. Return value of [`useVirtual()`](#usevirtual).

#### `callback: Function() => void 0`

**Required**. Gets called when at least one of [events](#numeric-event-constants) gets triggered.

#### `events: Array<Integer>`

**Required**. Array of [events](#numeric-event-constants) to subscribe

---

## Subscription

Rerendered, when at least one of passed [events](#numeric-event-constants) is triggered.

```jsx
<Subscription model={model} events={events}>
    {() => {}}
</Subscription>
```

#### `model: Model`

**Required**. Return value of [`useVirtual()`](#usevirtual).

#### `children: Function() => ReactElement`

**Required**. Render prop.

#### `events: Array<Integer>`

**Required**. Defaults to: [`EVT_ALL`](#numeric-event-constants)

export default ({ children }) => (
    <>
        <CommonHead title="Docs: Headless" />
        {children}
    </>
);

export const getStaticProps = () => ({ props: { dirtyMdxLayout: "virtual" } });
